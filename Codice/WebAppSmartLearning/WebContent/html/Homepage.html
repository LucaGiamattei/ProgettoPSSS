<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Smart Learning</title>
<!-- <link rel="stylesheet" href="index.css"/> -->
<link rel="stylesheet" href="../css/demo.css" type="text/css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" type="text/css"/>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js" ></script>


</head>

<body>

<nav class="navbar navbar-default navbar-static-top">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href=".">Smart Learning</a>
		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
	</div>
	<div class="navbar-collapse collapse">
		<ul class="nav navbar-nav">
			<li class="active"><a href="Homepage.html">Home</a></li>
			<li><a href="ProfiloPage.html">Profilo</a></li>
			<li><a href="#">Documentazione</a></li>
			<li><a href="#">Contatti</a></li>
			<li><a href="Upgrade.html" class="januscon">Upgrade Docente</a></li>
		</ul>
	</div>
</div>
</nav>

<div class="container" id="mainPage">

			<div class = "row">
				<div class="col-md-12 ">
	
				<form class="form-group">
				<div class="col-md-10">
				  <input type="text" class="form-control" id="ricercaform" placeholder="Cerca per cognome docente oppure per topic">
				</div>
				<div class="col-md-2">
				  <button type="button" onclick="ricerca()" class="btn btn-primary">Cerca</button>
				 </div>
				</form>
				</div>
			</div>
			<br>
			<br>
			<br>
				<div class="row lista">
				  

				</div>
							
			</div>

</body>

<script type="text/javascript">
	
function ricerca(){
	
	var myId = localStorage['myId'];

	if(myId == undefined){
		myId = "";
	}
	
	var elements = document.getElementsByClassName("scheda");
	var len = elements.length
	for (var i= 0; i<elements.length;i++){
		elements[i].remove();
	}
	
	var request = new XMLHttpRequest();
	var ricerca = document.getElementById("ricercaform").value;

	console.log("ricercafunction "+ ricerca);
	
	var url = "../riservate/Search";
	var params = "ricerca="+ricerca+"&requesterId="+myId;
	request.open('POST', url, true);

	//Send the proper header information along with the request
	request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

	request.onreadystatechange = function() {//Call a function when the state changes.
	    if(request.readyState == 4 && request.status == 200) {
	    	gestisciRisposta(request.responseXML);
	    }
	}
	request.send(params);
}

function gestisciRisposta(responseXML) {
	if(responseXML != null){
		if(responseXML.getElementsByTagName("risposta").length > 0) {
			var risposta = responseXML.getElementsByTagName("risposta")[0];
			
			for (i = 0; i < risposta.childNodes.length; i++){
				$('.lista').append('<div class="col-sm-6 scheda">'+
					    '<div class="card">'+
					      '<div class="card-body">'+
					        '<h2 class="card-title">'+risposta.childNodes[i].getElementsByTagName("nome")[0].childNodes[0].nodeValue+'</h2>'+
					        '<p class="card-text">'+
					        '<p>Docente: '+risposta.childNodes[i].getElementsByTagName("cognomedoc")[0].childNodes[0].nodeValue+ ' '+
					        risposta.childNodes[i].getElementsByTagName("nomedoc")[0].childNodes[0].nodeValue+ '</p>'+
					        '<p>Topic: '+risposta.childNodes[i].getElementsByTagName("topic")[0].childNodes[0].nodeValue+
					        '</p>'+
					        '<p>Score lezione: '+risposta.childNodes[i].getElementsByTagName("score")[0].childNodes[0].nodeValue+ '  |  '+
					        ' Numero massimo studenti: '+risposta.childNodes[i].getElementsByTagName("nstudenti")[0].childNodes[0].nodeValue+ '</p>'+
					        '</p>'+
					        '<p>Lezioni programmate: </p>'+
					        '<div class="fasce'+i+'"></div>'+
					        '<a href="#" class="btn btn-success">Prenota ora</a>'+
					      '</div>'+
					    '</div>'+
					  '</div>');
				
				for(j=0; j < risposta.childNodes[i].getElementsByTagName("fascia").length; j++){
					$('.fasce'+i).append(
						'<p>Data: '+risposta.childNodes[i].getElementsByTagName("fascia")[j].getElementsByTagName("data")[0].childNodes[0].nodeValue+
						'  |  Orario: '+risposta.childNodes[i].getElementsByTagName("fascia")[j].getElementsByTagName("orarioinizio")[0].childNodes[0].nodeValue+' - '+
						risposta.childNodes[i].getElementsByTagName("fascia")[j].getElementsByTagName("orariofine")[0].childNodes[0].nodeValue+
						'  |  Prezzo: '+risposta.childNodes[i].getElementsByTagName("fascia")[j].getElementsByTagName("prezzo")[0].childNodes[0].nodeValue+' â‚¬'+
						'</p>'					
					);
					
				}
			}
			
			
		}
	}else{
		window.location.replace("http://localhost:8080/WebAppSmartLearning");
	}
}
	
</script>

